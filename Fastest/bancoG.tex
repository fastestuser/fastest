\documentclass{article}
\usepackage{czt}

\begin{document}
\begin{axdef}
gates, obama, clinton: ACCNUM
\end{axdef}

\begin{zed}
CheckBalance == \\
  \t1 CheckBalanceOk \lor AccountNotExists \\
  \t1 \lor IncorrectAmount \lor NotAnOwner
\end{zed}


\begin{schema}{Bank}
clients: UID \pfun NAME \\
balances: ACCNUM \pfun BALANCE \\
owners: UID \rel ACCNUM
\end{schema}

\begin{schema}{NewClientOk}
\Delta Bank \\
u?:UID; name?:NAME; 
n?:ACCNUM
\where
clients' = clients \cup \( \{ \( u? \mapsto name? \) \} \)\\
u? \notin \dom clients \\
n? \notin \dom balances \\
balances' = balances \cup \{n? \mapsto 0\} \\
owners' = owners \cup \{u? \mapsto n?\}
\end{schema}

\begin{zed}
ClientAlreadyExists == \\
  \t1 [\Xi Bank; u?:UID | u? \in \dom clients] \also
AccountAlreadyExists == \\
  \t1 [\Xi Bank; n?:ACCNUM | n? \in \dom balances] \also
NewClient == \\
  \t1 NewClientOk \lor \\
  \t1 ClientAlreadyExists \lor AccountAlreadyExists
\end{zed}


\begin{zed}
ClientNotExists == [\Xi Bank; u?:UID | u? \notin \dom clients] \also
NewAccount == \\
  \t1 NewAccountOk \lor \\
  \t1 ClientNotExists \lor AccountAlreadyExists
\end{zed}

\begin{schema}{DepositOk}
\Delta Bank \\
n?: ACCNUM; 
m?: MONEY 
\where
n? \in \dom balances \\
m? > 0 \\
balances' = balances \oplus \{n? \mapsto balances~n? + m?\} \\
clients' = clients \\
owners' = owners
\end{schema}

\begin{zed}
IncorrectAmount == [\Xi Bank; m?: MONEY | m? \leq 0] \also
Deposit == \\
  \t1 DepositOk \lor AccountNotExists \lor IncorrectAmount \also
AccountNotExists == \\
  \t1 [\Xi Bank; n?: ACCNUM | n? \notin \dom balances] \also
\end{zed}

\begin{schema}{NewAccountOk}
\Delta Bank \\
u?: UID; 
n?:ACCNUM
\where
u? \in \dom clients \\
n? \notin \dom balances \\
balances' = balances \cup \{n? \mapsto 0\} \\
owners' = owners \cup \{u? \mapsto n?\} \\
clients' = clients
\end{schema}

\begin{schema}{WithdrawOk}
\Delta Bank \\
u?: UID; 
n?: ACCNUM; 
m?: \nat
\where
u? \mapsto n? \in owners \\
n? \in \dom balances \\
m? > 0 \\
m? \leq balances~n? \\
balances' = balances \oplus \{n? \mapsto balances~n? - m?\} \\
clients' = clients \\
owners' = owners
\end{schema}

\begin{zed}
NotAnOwner == \\
  \t1 [\Xi Bank; u?: UID; n?: ACCNUM | \\
    \t2 u? \mapsto n? \notin owners] \also
InsufficientFunds == \\
  \t1 [\Xi Bank; u?: UID; n?: ACCNUM; m?: \nat | \\
    \t2 m? > balances~n?] \also
Withdraw == \\
  \t1 WithdrawOk \\
  \t1 \lor AccountNotExists \\ 
  \t1 \lor IncorrectAmount \\
  \t1 \lor NotAnOwner \lor InsufficientFunds
\end{zed}

\begin{schema}{CheckBalanceOk}
\Xi Bank \\
u?: UID; 
n?: ACCNUM \\
balance!: MONEY
\where
u? \mapsto n? \in owners \\
n? \in \dom balances \\
balance! = balances~n?
\end{schema}

\begin{zed}
AddOwner == \\
  \t1 AddOwnerOk \lor \\
  \t1 NotAnOwner \lor OwnerAlreadyExists \\
OwnerAlreadyExists == \\
  \t1 [\Xi Bank; t?:UID; n?:ACCNUM | \\
    \t2 t? \mapsto n? \in owners] \also
\end{zed}

\begin{schema}{AddOwnerOk}
\Delta Bank \\
u?, t?:UID; 
n?:ACCNUM
\where
u? \mapsto n? \in owners \\
t? \mapsto n? \notin owners \\
owners' = owners \cup \{t? \mapsto n?\} \\
clients' = clients \\
balances' = balances
\end{schema}


\begin{zed}
[ACCNUM, UID, NAME] \\
MONEY == \nat \\
BALANCE == \nat
\end{zed}

\end{document}
